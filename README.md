# Hearable EarSurfaceTemperature
---
## Overview
Hearable HeadTrackerはヒアラブルデバイス（フォスター電機 RN002）に実装されている耳表面温度を測定する機能のフロントエンドアプリケーションです。\
★ デモ用Webサイト [https://foster-hearable.github.io/EarSurfaceTemperature/](https://foster-hearable.github.io/EarSurfaceTemperature/) 

WebBluetoothを用いてヒアラブルデバイスRN002からデータ取得を行い、温度情報の表示ややWebSocketでのデータ送出を行います。\
WebSocketのデータは温度のRAWデータで構成されているため、WebSocketサーバー側での加工や解析に用いることができます。

## 対応ブラウザ
WebBluetoothに対応したブラウザ（参考：[ブラウザー互換性一覧表 Mozilla.org](https://developer.mozilla.org/ja/docs/Web/API/Web_Bluetooth_API#ブラウザーの互換性)）
#### 動作することを確認しているブラウザ
- Chrome（Windows,Mac,Android）
- Edge（Windows,Mac）
  
#### 動作しないことを確認しているブラウザ
- Safari（Mac,iOS）
- Chrome (iOS)


## 操作インターフェース
<img src="Panel.png" width="450">

#### ① PPG Level
ヒアラブルデバイスより送られてくる耳表面温度のデータ履歴を表示します。（最大100秒）

#### ② Controls
- Start Notify：クリックするとBLEデバイスの選択ウィンドウが表示されます（選択後、通知データが送られてくるまで20秒程度かかる場合があります）
- Stop Notify：ヒアラブルデバイスからのデータ通知を停止する場合にクリックします。データ通知を再開させたい場合にはブラウザをリロードしてください。

#### ③ Settings
- Reference Temperature：ヒアラブルデバイスに保存されている基準となる耳表面温度が表示されます。Setボタンを押下することにより任意の値をヒアラブルデバイスに書き込むこともできます。
- Temperature Coefficient：ヒアラブルデバイスに保存されている温度係数が表示されます。Setボタンを押下することにより任意の値をヒアラブルデバイスに書き込むこともできます。

#### ④ WebSocket
- WebSocket URL：WebSocketで接続するURLを指定してください。
- Connect：WebSocket URLとの接続/切断を行います。本ページがロードされた直後に自動的に接続を試みます。
  
#### ⑤ Status
- 接続しているデバイス名や受信したデータの種別やデータ数を表示します

## WebSocketでの拡張
WebSocketで送られてきたヒアラブルデバイスの温度データを各種解析ツールのインプットとして用いることにより、ヒアラブルデバイスで取得した生体データを多面的な解析に利用することが可能となります。

<img src="Expand.png" width="450">

#### WebSocketデータフォーマット
コンマ区切りで下記順序のデータ列を送出します。

|   | データ種別 | フォーマット |
|-|-|-|
| 1 | 耳表面温度 Tb | 温度（内）と温度（外）および係数より求められた耳表面温度データ[℃] |
| 2 | 係数 K | 温度（内）と温度（外）および耳表面温度との関係を示す |
| 3 | 温度（内） Ti | ヒアラブルデバイス内部の耳側に配置されたセンサーの示す温度データ[℃] |
| 4 | 温度（外） To | ヒアラブルデバイス内部の外側に配置されたセンサーの示す温度データ[℃] |


## 注意事項
- ヒアラブルデバイスに接続してからオブジェクトが回転するまで最大で20秒程度の時間がかかる場合があります。
- 予測温度の表示は行わないため、ヒアラブルデバイスを装着してから耳表面温度まで上昇するまでおよそ10分程度の時間がかかります。
- 左右のヒアラブルデバイスを使用している場合、状況に応じて自動的にどちらか片側のヒアラブルデバイスからのセンサー情報を取得します。\
  右または左の任意のヒアラブルデバイスからデータ取得を行いたい場合は、使用しないヒアラブルデバイスをチャージケースに収納してから接続してください。  
- 動作確認されているブラウザであっても、バージョンやプラグインの状況などによってはアプリケーションが正常に動作しないことがあります。また、ブラウザまたはシステムの省エネモードなどの影響によりデータ更新タイミングが変化する場合があります。
  
※ワイヤレス通信は周囲の状況によりデータ欠落や再送・遅延が発生します。センサーデータはこれらの事象を考慮したうえでご利用ください。\
※このアプリケーションはヒアラブルデバイス（フォスター電機 RN002）の評価を目的として[MITライセンス](https://github.com/foster-hearable/HeadTracker/blob/e59c1e2fe2de506fb53649f6b3cb550f1e6ca852/LICENSE.txt)の下に公開しております。
